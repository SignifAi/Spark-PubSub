machine:
  java:
    version: oraclejdk8
  services:
    - docker

dependencies:
  override:
    - cd spark-pubsub && mvn install -DskipTests

test:
  override:
    - env
    - cd spark-pubsub && mvn package verify coveralls:report site site:stage -Pcibuild -Dcoverall.repository.token=${COVERALLS_REPO_TOKEN}    
  post:
    - cp spark-pubsub/target/*.jar $CIRCLE_ARTIFACTS/
    - cp -ra target/staging $CIRCLE_ARTIFACTS/
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
deployment:
  master:
    branch: master
    owner: SignifAi
    commands:
      - env
      - cd spark-pubsub && mvn deploy -DskipTests
          pwd: spark-pubsub
